<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EMA523_12_IH_0001_s</title>

    <!-- 공통 js-->
    <script src="../../common_contents/common/js/app.js"></script>
    <script src="../../common_practice/common/js/solve_area_act.js"></script>

    <!-- 공통 css-->
    <link rel="stylesheet" href="./../../common_contents/common/css/app.css" />

    <!-- 개별 -->
    <script src="../../common_practice/common/js/puzzle.js"></script>
    <script src="../../common_practice/common/js/practice_zoom.js"></script>
    <link rel="stylesheet" href="./../../common_practice/common/css/app.css" />
    <link rel="stylesheet" href="./../../common_practice/css/ema523_12.css" />
  </head>
  <body>
    <div id="app_wrap" class="ema523_12_ih_0001">
      <section class="title type2">
        <h2 data-puzzle="pink" lang="y">
          계산을 하여 계산 결과를 따라가면 친구를 만날 수 있어요.
          <div class="picture_wrap" data-head="" data-tit=" ">
            <div class="img_box">
              <div class="img_wrap">
                <img src="../../common_practice/img/EMA523_12_IH/0001_bg.png" alt="" />
                <div class="text_group">
                  <span class="txt1" lang="y">포개었을 때 완전히 겹치는 두 도형을 서로 대칭이라고 합니다.</span>
                  <span class="txt2" lang="y">서로 합동인 두 도형은 대응변의 길이가 같습니다.</span>
                  <span class="txt3" lang="y">한 직선을 따라 접었을 때 완전히 겹치는 도형을 점대칭 도형이라고 합니다.</span>
                  <span class="txt4" lang="y">선대칭도형에서 대응점에서 대칭축까지의 거리는 다릅니다.</span>
                  <span class="txt5" lang="y">점대칭도형에서 대칭의 중심은 대응점끼리 이은 선분을 똑같이 둘로 나눕니다.</span>
                  <span class="txt6" lang="y">출발</span>
                  <span class="txt7" lang="y">우물</span>
                </div>
              </div>
            </div>
            <button class="zoom"></button>
          </div>
        </h2>
      </section>

      <section class="contents">
        <div class="flex justify_center">
          <div class="map_area">
            <img src="../../common_practice/img/EMA523_12_IH/0001_bg.png" alt="" />
            <div class="text_group">
              <span class="txt1" lang="y">포개었을 때 완전히 겹치는 두 도형을 서로 대칭이라고 합니다.</span>
              <span class="txt2" lang="y">서로 합동인 두 도형은 대응변의 길이가 같습니다.</span>
              <span class="txt3" lang="y">한 직선을 따라 접었을 때 완전히 겹치는 도형을 점대칭 도형이라고 합니다.</span>
              <span class="txt4" lang="y">선대칭도형에서 대응점에서 대칭축까지의 거리는 다릅니다.</span>
              <span class="txt5" lang="y">점대칭도형에서 대칭의 중심은 대응점끼리 이은 선분을 똑같이 둘로 나눕니다.</span>
              <span class="txt6" lang="y">출발</span>
              <span class="txt7" lang="y">우물</span>
            </div>
            <svg viewBox="0 0 1537.8 1450.2" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                class="load1"
                data-quiz="포개었을 때 완전히
                                겹치는 두 도형을 서로
                                대칭이라고 합니다."
                data-left="10"
                data-right="11"
                data-true="11"
                d="M295.9,298.9c0,0-7.4,84.2,41.6,97.3c0,0,73.9,12.6,79.6-36.8c0,0,3.3-13.5-2.5-156.6c0,0-5.3-45.8,32.6-50.7  c0,0,36.7-3.7,36.7,33.5l2,130.8c0,0-2,30.3,22.4,29.8c0,0,21.2,2.9,22.4-17.6v-61.3c0,0-2-42.5,29.8-45.8"
                stroke="none"
              />
              <path
                class="load2"
                data-quiz="서로 합동인 두 도형은
                                대응변의 길이가
                                같습니다.
                                "
                data-left="20"
                data-right="21"
                data-true="20"
                d="M963,286.3l45.7-0.8c0,0,29.4-1.2,29.4,37.6c0,0,5.1,38.8-32.7,38.8l-191.8,6.2c0,0-24.9,1.2-22.4-18.4  c0,0-0.8-13.9,17.1-13.5l39.2-0.8c0,0,16.7-0.8,15.1-15.3c0,0,2-13.3-21.4-13.3c0,0-66.7-1-85.1,4.1c0,0-24.1,3.7-18.8,29.1  c0,0,9,37.6-20.4,39.2c0,0-23,2.3-23.3-18c-0.1-6.6,3.7-25.4-13.9-38c0,0-18.8-17.4-57.5-8.2c0,0-40.2,8.2-44.3,73.6  c0,0-3.1,46,34.7,56.2c0,0,48,16.1,102.2-1c0,0,9.8-3.7,17.1-17.6c0,0,12.2-18.8,29.4-2.9c0,0,11.5,7.8,7.8,51.1  c-0.3,4.1,2,22.1,30.2,14.3c0,0,29.6-9.8,67.3,24.9"
                stroke="none"
              />
              <path
                class="load3"
                data-quiz="한 직선을 따라 접었을 때 완전히 겹치는 도형을
							점대칭도형이라고 합니다. "
                data-left="30"
                data-right="31"
                data-true="31"
                d="M936.5,552.9c-0.1,2.1,0,18.8,46.9,15.1c0,0,96.3-9.4,105.7,15.1c0,0,10.6,27-21,28l-145.5,3.5  c0,0-37.5,2.5-36.3-20.8c0,0,2.9-28.6-20.4-28.6c0,0-19.2,0.2-72.3-0.8c0,0-23.7,1.2-38.3-17.6c0,0-16.7-24.9-54.3-12.7  c0,0-37.1,9.8-35.9,53.6c0,0-3.3,40.1,32.7,40.9l83.7,1"
                stroke="none"
              />
              <path
                class="load4"
                data-quiz="선대칭도형에서 대응점
                                에서 대칭축까지의 거리는
                                다릅니다.
                                "
                data-left="40"
                data-right="41"
                data-true="41"
                d="M762.2,705.3l-100-4.1c0,0-56.7-1.2-57.9-51.1c0,0,0.6-62.1-5.7-84.6c-0.2-0.8-0.7-2.1-0.9-2.9  c-7.2-20.4-15.1-45.2-72.3-60.5c0,0-147.9-31.9-326.5,0.8c0,0-25.3,4.1-31.4,33.9c0,0-7.2,50.9,0,80.5c0,0,0.8,24.5,39.2,22.1  c0,0,47.4,0.8,49.4-30.3c0,0,1-14.3,4.1-35.7c0,0-1-21.5,25.5-26.6c0,0,94.9-25.6,225.5,10.3c0,0,46.9,7.2,39.8,82.8  c0,0-2.7,27-35.7,27.6c0,0-24.1,1-27.6-28.6c0,0,0.2-24.3-41-26.8c0,0-48.8-5.1-90.6,10.2c0,0-14.3,4.1-16.3,30.9  c0,0-3.7,26.4,28.6,27.2c5.3,0.1,29-0.4,28.6,26l3.1,69.5c0,0-1,23.5,38.8,25.6"
                stroke="none"
              />
              <path
                class="load5"
                data-quiz="점대칭도형에서 대칭의
                                중심은 대응점끼리 이은 선분을
                                똑같이 둘로 나눕니다.
                                "
                data-left="50"
                data-right="51"
                data-true="51"
                d="M642.5,832.8l165.3,1c0,0,33,0.2,29.4,25.6c0,0,0.8,22.5-45.7,20.4l-134.7-2.5c0,0-26.1-1.6-26.1,20.8  c0,0-2.5,18,30.2,18.4l110.2,2.1c0,0,22.9,0.4,20,19.2c0,0-0.4,17.6-36.3,16.5l-146.9,1c0,0-17.1,0-19.6-10.3c0,0-1.2-18-37.9-17.6  c0,0-31-2.1-36.3,20.4c0,0-8.6,40.1,14.3,42.9l41.8,0.2c0,0,24.3-1.4,23.5,20.4c0,0,0.8,26-34.7,21.5c0,0-31.5-8.6-36.7,15.3  c0,0-6.1,22.3,25.5,23.5c0,0,74.5-2.1,90.8-0.4"
                stroke="none"
              />
              <path class="load6" d="M1045,1085.7l64.1-0.4c0,0,29,1.6,31.9-23.3l2-47.8c0,0-0.4-26.4,24.1-29.9c0,0,50.2-7.4,146.3,2.3  c0,0,36.1,4.3,31.6,28c0,0,0,22.9-40.8,22.1l-89.8,0.4c0,0-27,0.4-28.6,24.5c0,0-4.1,25.4,23.5,27.2l129.2-2.3  c0,0,37.9-1.2,35.9,19.6c0,0,2.5,22.5-51.9,21.5c0,0-199.2,0.8-246.1,1.8c0,0-52.2-0.8-65.1,30.9c0,0-16.9,41.5,15.3,46  c0,0,3.7,2.9,129.6,0" stroke="none" />
              <image id="obj_move" href="../../common_practice/img/EMA523_12_IH/0001_obj1.png" x="180" y="182" width="182" height="205" />
            </svg>
            <span class="obj_arrival"><img src="../../common_practice/img/EMA523_12_IH/0001_obj1.png" alt="도착 이미지" /></span>
          </div>
        </div>
        <div class="btn_area">
          <button class="btnReset">리셋</button>
        </div>
      </section>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const obj = document.getElementById('obj_move');
          const pathElements = document.querySelectorAll("svg path[class^='load']");
          let currentPathIndex = 0;
          let state = 'ready'; // ready, moving, quiz

          function moveAlongPath(pathEl) {
            state = 'moving';

            const pathLength = pathEl.getTotalLength();
            const speed = 200;
            const duration = (pathLength / speed) * 1000;

            const fps = 60;
            const steps = Math.round(duration / (1000 / fps));
            let step = 0;

            const start = pathEl.getPointAtLength(0);
            obj.setAttribute('x', start.x - obj.width.baseVal.value / 2);
            obj.setAttribute('y', start.y - obj.height.baseVal.value / 2);
            // obj.setAttribute("transform", "scale(0.9)");

            const interval = setInterval(() => {
              const progress = step / steps;
              const point = pathEl.getPointAtLength(progress * pathLength);

              obj.setAttribute('x', point.x - obj.width.baseVal.value / 2);
              obj.setAttribute('y', point.y - obj.height.baseVal.value / 2);

              step++;

              if (step > steps) {
                clearInterval(interval);
                state = 'quiz'; // 이동 완료 후 퀴즈 대기
              }
            }, 1000 / fps);
          }

          function renderFractionHTML(str) {
            return str
              .split('+')
              .map((part) => {
                const mixedMatch = part.match(/^(\d+)\((\d+)\)\/\((\d+)\)$/);
                const fractionMatch = part.match(/^\((\d+)\)\/\((\d+)\)$/);

                if (mixedMatch) {
                  return `
										<div class="fraction_box_wrap">
											<span>${mixedMatch[1]}</span>
											<div class="fraction_box">
												<span>${mixedMatch[2]}</span>
												<span>${mixedMatch[3]}</span>
											</div>
										</div>
									`;
                } else if (fractionMatch) {
                  return `
										<div class="fraction_box">
											<span>${fractionMatch[1]}</span>
											<span>${fractionMatch[2]}</span>
										</div>
									`;
                } else {
                  return `<span>${part}</span>`;
                }
              })
              .join('<span class="operator">+</span>');
          }

          function showQuiz(pathEl) {
            const quiz = pathEl.dataset.quiz;
            const left = pathEl.dataset.left;
            const right = pathEl.dataset.right;
            const correct = pathEl.dataset.true;

            const popArea = document.createElement('div');
            popArea.className = 'pop_area';
            popArea.innerHTML = `
							<div class="quiz_pop">
								<button type="button" class="close" style="display: none;"></button>
								<div class="inner_pop quiz${currentPathIndex + 1}">
									<div class="txt_quiz">${renderFractionHTML(quiz)}</div>
									<div class="question_box">
										<button type="button" class="left" data-answer-single="${left === correct}">
											${renderFractionHTML(left)}
										</button>
										<div class="center">
											<img src="../../common_practice/img/EMA511_09_IH/0001_obj3.png" alt="">
										</div>
										<button type="button" class="right" data-answer-single="${right === correct}">
											${renderFractionHTML(right)}
										</button>
									</div>
								</div>
							</div>
						`;

            document.querySelector('.contents')?.after(popArea);

            const leftBtn = popArea.querySelector('.left');
            const rightBtn = popArea.querySelector('.right');

            leftBtn.addEventListener('click', checkAnswer);
            rightBtn.addEventListener('click', checkAnswer);
          }

          function checkAnswer(e) {
            const selected = e.currentTarget;
            const isCorrect = selected.dataset.answerSingle === 'true';

            const quizPop = document.querySelector('.quiz_pop');

            if (isCorrect) {
              quizPop.classList.remove('error');
              quizPop.classList.add('result');

              const closeBtn = quizPop.querySelector('.close');
              closeBtn.style.display = 'block';

              closeBtn.addEventListener('click', () => {
                document.querySelector('.pop_area')?.remove();
                currentPathIndex++;
                if (currentPathIndex < pathElements.length) {
                  moveAlongPath(pathElements[currentPathIndex]);
                } else {
                  document.querySelector('.map_area')?.classList.add('result');
                  state = 'done';
                }
              });
            } else {
              quizPop.classList.remove('result');
              quizPop.classList.add('error');
              setTimeout(() => {
                quizPop.classList.remove('error');
              }, 1000);
            }
          }

          obj.addEventListener('click', () => {
            if (state === 'ready' && currentPathIndex < pathElements.length) {
              moveAlongPath(pathElements[currentPathIndex]);
            } else if (state === 'quiz') {
              showQuiz(pathElements[currentPathIndex]);
            }
          });
        });
      </script>
    </div>
  </body>
</html>
