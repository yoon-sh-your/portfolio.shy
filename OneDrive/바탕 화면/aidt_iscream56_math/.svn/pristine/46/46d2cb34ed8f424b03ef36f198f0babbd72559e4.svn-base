<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EMA611_07_IH_0001</title>
    

    <!-- 공통 js-->
    <script src="../../common_contents/common/js/app.js"></script>
		<script src="../../common_practice/common/js/solve_area_act.js"></script>

    <!-- 공통 css-->
    <link rel="stylesheet" href="./../../common_contents/common/css/app.css" />

    <!-- 개별 -->
    <script src="../../common_practice/common/js/puzzle.js"></script>
    <script src="../../common_practice/common/js/practice_zoom.js"></script>
    <link rel="stylesheet" href="./../../common_practice/common/css/app.css" />
    <link rel="stylesheet" href="./../../common_practice/css/ema611_07.css" />
  </head>
  <body>
    <div id="app_wrap" class="ema611_07_ih_0001">
      <section class="title type2">
        <h2 data-puzzle="purple">
          <span class="empty_box nemo head"></span></span>
          <span lang="y">안에 알맞은 수만큼 순서대로 다람쥐를 이동하여 먹이를 찾아보세요.</span>
          <div class="picture_wrap" data-head="" data-tit=" ">
            <div class="img_box">
              <div class="img_wrap">
                <img src="../../common_practice/img/EMA611_07_IH/0001_01.png" alt="" />
              </div>
            </div>
            <button class="zoom"></button>
          </div>
        </h2>
      </section>

      <section class="contents">
        <div class="flex justify_center">
          <div class="map_area">
            <img src="../../common_practice/img/EMA611_07_IH/0001_01.png" alt="" />
            <div class="text_group">
              <div class="texts text1">
                <i class="num">1</i>
                <div class="fraction_box"><span>1</span><span>11</span></div>
                ÷3=
                <div class="fraction_box">
                  <span>
                    <span class="empty_box nemo"></span>
                  </span>
                  <span>33</span>
                </div>
                <img src="../../common_practice/common/img/icon_arrow_right_navy.svg" alt="" />
                <p lang="y">왼쪽으로</p>
                <span class="empty_box nemo"></span>
                <p lang="y">칸 이동</p>
              </div>

              <div class="texts text2">
                <i class="num">2</i>
                <div class="mixed_fraction">
                  <span>2</span>
                  <div class="fraction_box"><span>1</span><span>2</span></div>
                </div>
                ÷5=
                <div class="fraction_box">
                  <span>
                    <span class="empty_box nemo"></span>
                  </span>
                  <span>2</span>
                </div>
                <img src="../../common_practice/common/img/icon_arrow_right_navy.svg" alt="" />
                <p lang="y">아래쪽으로</p>
                <span class="empty_box nemo"></span>
                <p lang="y">칸 이동</p>
              </div>

              <div class="texts text3">
                <i class="num">3</i>
                <div class="mixed_fraction">
                  <span>1</span>
                  <div class="fraction_box"><span>1</span><span>3</span></div>
                </div>
                ÷2=
                <div class="fraction_box">
                  <span>2</span>
                  <span>
                    <span class="empty_box nemo"></span>
                  </span>
                </div>
                <img src="../../common_practice/common/img/icon_arrow_right_navy.svg" alt="" />
                <p lang="y">오른쪽으로</p>
                <span class="empty_box nemo"></span>
                <p lang="y">칸 이동</p>
              </div>

              <div class="texts text4">
                <i class="num">4</i>
                5÷2=<span class="empty_box nemo"></span>
                <div class="fraction_box">
                  <span>1</span>
                  <span> 2 </span>
                </div>
                <img src="../../common_practice/common/img/icon_arrow_right_navy.svg" alt="" />
                <p lang="y">위쪽으로</p>
                <span class="empty_box nemo"></span>
                <p lang="y">칸 이동</p>
              </div>
              <p class="text_direction up" lang="y">위쪽</p>
              <p class="text_direction right" lang="y">오른쪽</p>
              <p class="text_direction down" lang="y">아래쪽</p>
              <p class="text_direction left" lang="y">왼쪽</p>
            </div>
            <svg viewBox="0 0 746.1 747.9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path class="load1" d="M366.8,368.5c-34.6,0-69.3,0-104,0" stroke="transparent" data-quiz="1" />
              <path class="load2" d="M258.3,365.9c0,41.4,0,82.8,0,124.2" stroke="transparent" data-quiz="1" />
              <path class="load3" d="M266.9,487.3c103.5,0,207,0,310.5,0" stroke="transparent" data-quiz="1" />
              <path class="load4" d="M586.8,484.6c0-68.9,0-137.7,0-206.6" stroke="transparent" data-quiz="1" />
              <image id="obj_move" href="../../common_practice/img/EMA611_07_IH/0001_obj.png" x="319" y="290" width="120" height="132" />
            </svg>
            <!-- <span class="obj_arrival"
							><img src="../../common_practice/img/EMA523_12_IH/0001_obj1.png" alt="도착 이미지"
						/></span> -->
          </div>
        </div>

    

<!-- 해설 -->
<div class="solve_area">
  <div class="inner_solve">
    <div class="flex">
      <strong class="tit_solve" lang="y">해설</strong>
      <div class="conts_solve">
          <p lang="y" class="flex gap_4 align_center">
            <span class="num">1</span>
            <span class="fraction_box">
              <span>1</span>
              <span> 11 </span>
            </span>
            <span>÷ 3 =</span>
            <span class="fraction_box">
              <span>1</span>
              <span> 11 </span>
            </span>
            <span>×</span>
            <span class="fraction_box">
              <span>1</span>
              <span> 3 </span>
            </span>
            <span>=</span>
            <span class="fraction_box">
              <span class="ok">1</span>
              <span> 33 </span>
            </span>
            <span>➔ 왼쪽으로 1칸 이동</span>
          </p>
          <p lang="y" class="flex gap_4 align_center">
            <span class="num">2</span>
            <span>2</span>
            <span class="fraction_box">
              <span>1</span>
              <span> 2</span>
            </span>
            <span>÷ 5 =</span>
            <span class="fraction_box">
              <span>5</span>
              <span> 2 </span>
            </span>
            <span>÷ 5 =</span>
            <span class="fraction_box">
              <span class="mark_error">5<i>1</i></span>
							<span>2</span>
            </span>
            <span>×</span>
            <span class="fraction_box">
              <span>1</span>
              <span class="mark_error">5<i>1</i></span>
							
            </span>
            <span>=</span>
            <span class="fraction_box">
              <span class="ok">1</span>
              <span> 2 </span>
            </span>
            <span>➔ 아래쪽으로 1칸 이동</span>
          </p>
          <p lang="y" class="flex gap_4 align_center">
            <span class="num">3</span>
            <span>1</span>
            <span class="fraction_box">
              <span>1</span>
              <span> 3</span>
            </span>
            <span>÷ 2 =</span>
            <span class="fraction_box">
              <span>4</span>
              <span> 3 </span>
            </span>
            <span>÷ 2 =</span>
            <span class="fraction_box">
              <span class="mark_error">4<i>2</i></span>
							<span>3</span>
            </span>
            <span>×</span>
            <span class="fraction_box">
              <span>1</span>
              <span class="mark_error">2<i>1</i></span>
							
            </span>
            <span>=</span>
            <span class="fraction_box">
              <span> 2 </span>
              <span class="ok">3</span>
              
            </span>
            <span>➔ 오른쪽으로 3칸 이동</span>
          </p>
          <p lang="y" class="flex gap_4 align_center">
            <span class="num">4</span>
            <span>5 ÷ 2 =</span>
            <span class="fraction_box">
              <span>5</span>
              <span>2 </span>
            </span>
            <span>=</span>
            <span class="ok">2</span>
            <span class="fraction_box">
              <span>1</span>
              <span> 2 </span>
            </span>
            <span>➔ 위쪽으로 2칸 이동</span>
          </p>
        </div>
    </div>
    <div class="buttons_solve">
    </div>
  </div>
</div>


        <div class="btn_area all">
          <button class="btnReset">리셋</button>
        </div>

      </section>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const obj = document.getElementById('obj_move');
        const pathElements = document.querySelectorAll("svg path[class^='load']");
        let currentPathIndex = 0;
        let state = 'ready'; // ready, quiz, moving, done

        const data = [
          {
            id: 1,
            html: `<div class="fraction_box">
									<span>1</span>
									<span>11</span>
								</div>
								÷3=
								<div class="fraction_box">
									<span>
										<span class="input_wrap">
											<math-field data-answer-single="1"></math-field>
										</span>
									</span>
									<span>33</span>
								</div>
								<img src="../../common_practice/common/img/icon_arrow_right_navy.svg" class="arrow" />
								<span lang="y">왼쪽으로</span>
								<div class="input_wrap">
									<math-field data-answer-single="1"></math-field>
								</div>
								<span lang="y">칸 이동</span>
						`,
          },
          {
            id: 2,
            html: `<div class="mixed_fraction">
								<span>2</span>
								<div class="fraction_box">
									<span>1</span>
									<span>2</span>
								</div>
								</div>
								÷5=
								<div class="fraction_box">
									<span>
										<div class="input_wrap">
											<math-field data-answer-single="1"></math-field>
										</div>
									</span>
									<span>2</span>
								</div>
								<img src="../../common_practice/common/img/icon_arrow_right_navy.svg" class="arrow" />
								<span lang="y">아래쪽으로</span>
								<div class="input_wrap">
									<math-field data-answer-single="1"></math-field>
								</div>
								<span lang="y">칸 이동</span>
						`,
          },
          {
            id: 3,
            html: `<div class="mixed_fraction">
								<span>1</span>
								<div class="fraction_box">
									<span>1</span>
									<span>3</span>
								</div>
								</div>
								÷2=
								<div class="fraction_box">
									<span>2</span>
									<span>
										<div class="input_wrap">
											<math-field data-answer-single="3"></math-field>
										</div>
									</span>
									
								</div>
								<img src="../../common_practice/common/img/icon_arrow_right_navy.svg" class="arrow" />
								<span lang="y">오른쪽으로</span>
								<div class="input_wrap">
									<math-field data-answer-single="3"></math-field>
								</div>
								<span lang="y">칸 이동</span>
						`,
          },
          {
            id: 4,
            html: `5÷2=
								<div class="mixed_fraction">
								<span><div class="input_wrap">
											<math-field data-answer-single="2"></math-field>
										</div></span>
								<div class="fraction_box">
									<span>1</span>
									<span>2</span>
								</div>
								</div>
								<img src="../../common_practice/common/img/icon_arrow_right_navy.svg" class="arrow" />
								<span lang="y">위쪽으로</span>
								<div class="input_wrap">
									<math-field data-answer-single="2"></math-field>
								</div>
								<span lang="y">칸 이동</span>
						`,
          },
        ];

        function moveAlongPath(pathEl, callback) {
          state = 'moving';
          const pathLength = pathEl.getTotalLength();
          const speed = 200;
          const duration = (pathLength / speed) * 1000;
          const fps = 60;
          const steps = Math.round(duration / (1000 / fps));
          let step = 0;

          const start = pathEl.getPointAtLength(0);
          obj.setAttribute('x', start.x - obj.width.baseVal.value / 2);
          obj.setAttribute('y', start.y - obj.height.baseVal.value / 2);

          const interval = setInterval(() => {
            const progress = step / steps;
            const point = pathEl.getPointAtLength(progress * pathLength);

            obj.setAttribute('x', point.x - obj.width.baseVal.value / 2);
            obj.setAttribute('y', point.y - obj.height.baseVal.value / 2);

            step++;
            if (step > steps) {
              clearInterval(interval);
              state = 'ready';
              currentPathIndex++;
              if (typeof callback === 'function') callback();
            }
          }, 1000 / fps);
        }

        function showQuiz(pathEl) {
          state = 'quiz';

          const popArea = document.createElement('div');
          popArea.className = 'pop_area';
          popArea.innerHTML = `
            <div class="quiz_pop">
                <button type="button" class="close" ></button>
                <div class="inner_pop quiz${currentPathIndex + 1}">
                    <div class="question_box">
                        <div class="question_inner">
                            ${data[currentPathIndex].html}
                        </div>
                    </div>
                </div>
                <div class="btn_area">
                    <button class="btnType key">입력타입토글</button>
                    <button class="btnReset">리셋</button>
                    <button class="btnCheck">확인</button>
                </div>
            </div>
        `;

    document.querySelector('.contents')?.appendChild(popArea);

// MathLive 강제 렌더링
setTimeout(() => {
  if (window.MathfieldElement && window.MathfieldElement.renderMathInDocument) {
    window.MathfieldElement.renderMathInDocument(popArea);
  } else if (window.MathLive && window.MathLive.renderMathInElement) {
    window.MathLive.renderMathInElement(popArea);
  }


  
}, 0);

          

          const btnCheck = popArea.querySelector('.btnCheck');
          const btnReset = popArea.querySelector('.btnReset');
          const btnClose = popArea.querySelector('.close');
          const mathFields = popArea.querySelectorAll('math-field[data-answer-single]');


          

          // 입력시 버튼활성화
          mathFields.forEach((field) => {
            field.addEventListener('input', () => {
              let hasValue = false;
              mathFields.forEach((f) => {
                if (f.value && f.value.trim() !== '') hasValue = true;
              });
              if (hasValue) {
                btnCheck.classList.add('active');
                btnReset.classList.add('active');
              } else {
                btnCheck.classList.remove('active');
                btnReset.classList.remove('active');
              }
            });
          });

          // 리셋
          btnReset.addEventListener('click', () => {
            mathFields.forEach((field) => {
              field.value = '';
              if (typeof field.setValue === 'function') field.setValue('');
            });
            btnCheck.classList.remove('active');
            btnReset.classList.remove('active');
          });

          let lastAnswerCorrect = false; // ✨ 새로 추가

// 정답체크
btnCheck.addEventListener('click', () => {
  let isCorrect = true;
  mathFields.forEach((field) => {
    const answer = field.getAttribute('data-answer-single');
    const value = field.value?.trim() || '';
    if (value !== answer) isCorrect = false;
  });

  lastAnswerCorrect = isCorrect; // ✅ 정답 여부 저장

  if (isCorrect) {
    popArea.querySelector('.quiz_pop').classList.remove('error');
    popArea.querySelector('.quiz_pop').classList.add('result');
    btnClose.style.display = 'block';

    // ✅ 정답이면 0.5초 뒤에 팝업 닫기
    setTimeout(() => {
      btnClose.click();
    }, 500);

  } else {
    popArea.querySelector('.quiz_pop').classList.remove('result');
    popArea.querySelector('.quiz_pop').classList.add('error');
    setTimeout(() => {
      popArea.querySelector('.quiz_pop').classList.remove('error');
    }, 1000);
  }
});

// 클로즈 버튼 (닫고 나서 이동하는 부분 수정)
btnClose.addEventListener('click', () => {
  document.querySelector('.pop_area')?.remove();

  setTimeout(() => {
    document.querySelector('.contents .btn_area .btnReset')?.classList.add('active');
  }, 100);

  if (lastAnswerCorrect) {
    if (currentPathIndex < pathElements.length) {
      moveAlongPath(pathElements[currentPathIndex], () => {
        if (currentPathIndex < data.length) {
          state = 'ready';
        } else {
          state = 'done';
          // 🎯 모든 문제를 다 풀었으면 해설 활성화
          document.querySelector('.solve_area')?.classList.add('active');
        }
      });
    }
  } else {
    state = 'ready';
  }

  document.getElementById('app_wrap').scrollTo({ top: 550, left: 0, behavior: 'auto' });
});
        }

        // 다람쥐 클릭시에 다음 문제(진행중) 팝업 노출
        obj.addEventListener('click', () => {
          if (state === 'ready' && currentPathIndex < pathElements.length) {
            showQuiz(pathElements[currentPathIndex]);
          }
        });




// 전체 리셋 버튼 클릭
const allResetBtn = document.querySelector('.all .btnReset');

allResetBtn?.addEventListener('click', () => {
  // 1. 다람쥐 처음 위치로
  const obj = document.getElementById('obj_move');
  if (obj) {
    obj.setAttribute('x', 319);
    obj.setAttribute('y', 290);
  }

  // 2. 현재 경로 인덱스 초기화
  currentPathIndex = 0;

  // 3. 상태 초기화
  state = 'ready';

  // 4. 열린 팝업이 있다면 닫기
  const pop = document.querySelector('.pop_area');
  if (pop) pop.remove();

  // 5. 리셋 버튼 비활성화
  const contentResetBtn = document.querySelector('.contents .btn_area .btnReset');
  if (contentResetBtn) {
    contentResetBtn.classList.remove('active');
  }

  console.log('전체 리셋 완료!');
});









      });




      
    </script>
  </body>
</html>
