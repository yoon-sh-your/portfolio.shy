let r1;
let r2;
let count;
let w1;
let w2;
let w3;
let w4;

runAfterAppReady(function () {
    const boxContainer = document.querySelector('.box_container');
    r1 = boxContainer.querySelector('.r1');
    r2 = boxContainer.querySelector('.r2');
    count = r2.querySelectorAll('.small_div');
    w1 = r2.querySelector('.wrap.w1');
    w2 = r2.querySelector('.wrap.w2');
    w3 = r2.querySelector('.wrap.w3');
    w4 = r2.querySelector('.wrap.w4');

    createBigDiv();
    createBigDiv();
    createBigDiv();
    createSmallDiv();
    createSmallDiv();
    createSmallDiv();
    createSmallDiv();
    createSmallDiv();
    createSmallDiv();



    for (let i = 0; i < 36-9; i++) {
        createR2SmallDiv(r2);
    }

    for (let i = 0; i < 9; i++) {
        createR2SmallDiv(w1);
    }

    



    // ì•± ì¤€ë¹„ í›„ ì‹¤í–‰, jQuery ì‚¬ìš©ê°€ëŠ¥
    console.log("custom_answer_check.js ì‹¤í–‰");

    // ì»¤ìŠ¤í…€ ì±„ì  ëŒ€ìƒ ì¶”ê°€
    window.getCustomTargets = function (page) {
        return $(page).find(".r2");
    };

    // ì»¤ìŠ¤í…€ ì •ë‹µ ì¡°ê±´
    window.customCheckCondition = function (el) {
        // ì´ê³³ì— ì²´í¬ë²„íŠ¼ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì»¤ìŠ¤í…€ ì±„ì  ë¡œì§ì„ ì‘ì„±í•©ë‹ˆë‹¤.
        // ì²´í¬ë²„íŠ¼ í´ë¦­ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
        // return true ë°˜í™˜í•˜ë©´ ì •ë‹µ ì²˜ë¦¬ ë©ë‹ˆë‹¤.
        // return false ë°˜í™˜í•˜ë©´ ì˜¤ë‹µ ì²˜ë¦¬ ë©ë‹ˆë‹¤.
        // return "empty" ë°˜í™˜í•˜ë©´ ë¹„ì–´ìˆëŠ” ê²½ìš° ì²˜ë¦¬(í’€ì´ ë…ë ¤ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œìƒ)ë©ë‹ˆë‹¤.

        // ex) ìˆ«ì ì…ë ¥ì°½ì— ê°’ì´ 1ì´ìƒì´ë©´ ì •ë‹µ ì²˜ë¦¬, 1ì´í•˜ì´ë©´ ì˜¤ë‹µ ì²˜ë¦¬, ë¹„ì–´ìˆìœ¼ë©´ í’€ì´ ë…ë ¤ í† ìŠ¤íŠ¸ ë©”ì‹œì§€(ê¸°ë³¸ê°’) ë°œìƒ
        // const $el = $(el); //ì±„ì  ëŒ€ìƒ ì¶”ê°€ì—ì„œ ì¶”ê°€í•œ ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        // const rule = $el.data("answerCustom"); //ì±„ì  ëŒ€ìƒ ì¶”ê°€ì—ì„œ ì¶”ê°€í•œ ìš”ì†Œì˜ data-answer-custom ì†ì„±ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        // const val = $el.val(); //ì±„ì  ëŒ€ìƒ ì¶”ê°€ì—ì„œ ì¶”ê°€í•œ ìš”ì†Œì˜ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

        // // ì¡°ê±´ ì„¤ì •
        // if (val === "" || val == null) return "empty"; // ë¹„ì–´ìˆìœ¼ë©´ empty ì²˜ë¦¬

        // const num = parseFloat(val); //ìˆ«ìë¡œ ë³€í™˜
        // if (isNaN(num)) return "empty"; // empty ë°˜í™˜í•˜ë©´ ë¹„ì–´ìˆëŠ” ê²½ìš° ì²˜ë¦¬ ë©ë‹ˆë‹¤.

        // if (rule === "min-1") {
        //     return num >= 1; //false ë°˜í™˜í•˜ë©´ ì˜¤ë‹µ ì²˜ë¦¬ ë©ë‹ˆë‹¤.
        // }

        const answer = el.getAttribute('data-single-answer')
        const correction = el.getAttribute('data-connection');
        console.log('answer', answer);
        console.log('correction', correction);

        return answer === correction ? true : false; //true ë°˜í™˜í•˜ë©´ ì •ë‹µ ì²˜ë¦¬ ë©ë‹ˆë‹¤.
    };

    // // ì˜¤ë‹µ íšŸìˆ˜ ì»¤ìŠ¤í…€ ë°˜ì‘
    // window.onCustomIncorrect = function (count) {
    //     console.log(count);
    //     if (count === 2) {
    //         console.log("ì˜¤ë‹µ íšŸìˆ˜ 2íšŒ");
    //     }
    // };

    // ì»¤ìŠ¤í…€ ì •ë‹µ ì²˜ë¦¬ ì½œë°± ì„ ì–¸ ë°©ë²•
    // ì •ë‹µ ì‹œ ì¶”ê°€ ë™ì‘
    // window.onCorrectCustom = function () {
    //     alert("ğŸ‰ ì •ë‹µì´ì—ìš”!");
    // };

    // // ì˜¤ë‹µ ì‹œ ì¶”ê°€ ë™ì‘
    // window.onIncorrectCustom = function () {
    //     alert("â— ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.");
    // };

    // ë‘ ë²ˆì§¸ ì˜¤ë‹µ ì‹œ
    window.onIncorrectTwiceCustom = function () {
        // alert("ğŸš¨ ì •ë‹µ ê³µê°œë©ë‹ˆë‹¤!");
    };

    // // ì…ë ¥ ì•ˆ í–ˆì„ ë•Œ
    // window.onEmptyCustom = function () {
    //     alert("ğŸ‘€ ì…ë ¥ì„ ë¨¼ì € í•´ë³´ì„¸ìš”!");
    // };

    // ë¦¬ì…‹ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰í•  ì»¤ìŠ¤í…€ í•¨ìˆ˜
    window.resetCustom = function () {
        r2.innerHTML = '';
        count = r2.querySelectorAll('.small_div');

        // data-correction ì†ì„± ì œê±°
        r2.removeAttribute('data-correction');

        // data-connection ì†ì„± ì´ˆê¸°í™”
        r2.setAttribute('data-connection', JSON.stringify([]));

        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        window.forceWatchEvaluation();
    };

    // // ì˜ˆì‹œ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰í•  ì»¤ìŠ¤í…€ í•¨ìˆ˜
    // window.sampleCustom = function () {
    //     alert("ğŸ’¡ ì˜ˆì‹œ ë²„íŠ¼ í´ë¦­ë¨");
    // };

    //ì´ë ‡ê²Œê°€ ì—°ë™ëœ í•¨ìˆ˜ì˜ ì„ ì–¸ ë°©ë²•ì…ë‹ˆë‹¤.
    //ë²„íŠ¼ í™œì„±í™” ë¶€ë¶„ì€ ì•„ë˜ì™€ ê°™ì€ íŒ¨í„´ìœ¼ë¡œ ì„ ì–¸í•˜ë©´ ë©ë‹ˆë‹¤.
    const target = $(".r2");

    // 1. ê°’ ë³€ê²½ì„ ê°ì§€
    // 2. ê°’ ë³€ê²½ì‹œ ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ê²°ì •
    // ex) ìˆ«ì ì…ë ¥ì°½ì— ê°’ì´ ìˆìœ¼ë©´ ëª¨ë“  ë²„íŠ¼ í™œì„±í™”, ì—†ìœ¼ë©´ ë¹„í™œì„±í™”

    defineButtonClassRules([
        {
            selector: ".r2", //ë³€ê²½ë  ê°’ì„ ê°ì§€í•  íƒœê·¸ ì„¤ì •
            //ì•„ë˜ ì¤‘ í•˜ë‚˜ í™œìš©
            key: "check_target", // ê³µí†µ ë²„íŠ¼ê³¼ ë˜‘ê°™ì´ ê²°ì •ë˜ëŠ” í™œì„±í™” ì—¬ë¶€ ê²°ì • í‚¤
            //key: "custom_reset_btn_active", // ë¦¬ì…‹ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ê²°ì • í‚¤
            //key: "custom_sample_btn_active", // ì˜ˆì‹œë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ê²°ì • í‚¤
            // key: "custom_check_btn_active", // í™•ì¸ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ê²°ì • í‚¤
            //key: "custom_submit_btn_active", // ì œì¶œë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ê²°ì • í‚¤
            test: (el) => {
                //í™œì„±í™” ì—¬ë¶€ ê²°ì • ë¡œì§ true ë°˜í™˜í•˜ë©´ ë²„íŠ¼ í™œì„±í™”, false ë°˜í™˜í•˜ë©´ ë¹„í™œì„±í™”
                //elì€ íƒ€ê²Ÿì„ ì˜ë¯¸í•˜ëŠ” ìš”ì†Œ
                //ex) ê°’ì´ ë¹„ì–´ìˆê±°ë‚˜ nullì¸ ê²½ìš°ë¡œ ì¡°ê±´ ì„¤ì •í•œ ê²½ìš° ì˜ˆì‹œ
                // const val = $(el).val();
                // if (val == "" || val == null) {
                //     return false;
                // }
                // return true;

                // correction ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const correction = el.getAttribute('data-connection');
                // correction ì†ì„±ì´ ì—†ê±°ë‚˜ ë¹ˆ ë°°ì—´ì´ë©´ false
                return !correction || correction === '[]' ? false : true;
            },
            // setClass: [
            //     { target: ".btnReset", class: "active" },
            //     { target: ".btnCheck", class: "active" }
            // ]
        },
    ]);
    // // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ í›„ ê°•ì œ í‰ê°€ ë¬¸ ì‹¤í–‰
    // window.forceWatchEvaluation();

    // // ì œì¶œ ë²„íŠ¼ í´ë¦­ ì‹œ ì»¤ìŠ¤í…€ ê²€ì¦ ë¡œì§
    // window.customValidateBeforeSubmit = function ({ hasEmpty, isSelfCheckMissing, rules }) {
    //     console.log("ğŸ” ì»¤ìŠ¤í…€ ì œì¶œ ì „ ê²€ì¦ ë¡œì§ ì‹¤í–‰ë¨");
    //     console.log("ë¹ˆ í•­ëª© ì¡´ì¬ ì—¬ë¶€:", hasEmpty);
    //     console.log("ìê¸° ì ê²€ ë¯¸ì„ íƒ ì—¬ë¶€:", isSelfCheckMissing);
    //     console.log("ê²€ì‚¬ ê·œì¹™:", rules);

    //     // ì¡°ê±´ì— ë”°ë¼ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ í‘œì‹œ
    //     if (hasEmpty) {
    //         alert("âš ï¸ ë¹ˆ í•­ëª©ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì œì¶œì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.");
    //         return false; // ê¸°ë³¸ í† ìŠ¤íŠ¸ ë°©ì§€
    //     }

    //     return true; // ê¸°ë³¸ ë¡œì§ ê³„ì† ì‹¤í–‰
    // };
});








const createBigDiv = () => {
    const div = document.createElement('div');
    div.classList.add('big_div');
    div.textContent = '1';

    // div.addEventListener('click', () => {
    //     if (count.length < 50) {

    //         for (let i = 0; i < 10; i++) {
    //             createR2SmallDiv();
    //         }

    //         count = r2.querySelectorAll('.small_div');
    //         console.log(count.length);

    //         r2.setAttribute('data-connection', JSON.stringify([count.length]));
    //         // // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ í›„ ê°•ì œ í‰ê°€ ë¬¸ ì‹¤í–‰
    //         // window.forceWatchEvaluation();
    //     }
    // });

    r1.appendChild(div);
};

const createSmallDiv = () => {
    const div = document.createElement('div');
    div.classList.add('small_div');
    div.textContent = '0.1';

    // div.addEventListener('click', () => {
    //     if (count.length < 50) {

    //         createR2SmallDiv();

    //         count = r2.querySelectorAll('.small_div');
    //         console.log(count.length);

    //         r2.setAttribute('data-connection', JSON.stringify([count.length]));
    //         // // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ í›„ ê°•ì œ í‰ê°€ ë¬¸ ì‹¤í–‰
    //         // window.forceWatchEvaluation();
    //     }
    // });

    r1.appendChild(div);
}

const createR2SmallDiv = (parent) => {
    const div = document.createElement('div');
    div.classList.add('small_div');
    div.textContent = '0.1';

    div.addEventListener('click', () => {
        if (div.parentElement === r2) {
            // r2 ì•ˆì— ìˆìœ¼ë©´ wrapìœ¼ë¡œ ì´ë™
            if (w1.querySelectorAll('.small_div').length > 9) {
                w2.appendChild(div);
            } else if (w2.querySelectorAll('.small_div').length > 9) {
                w3.appendChild(div);
            } else if (w3.querySelectorAll('.small_div').length > 9) {
                w4.appendChild(div);
            } else {
                w1.appendChild(div);
            }
        } else {
            // wrap ì•ˆì— ìˆìœ¼ë©´ r2ë¡œ ì´ë™
            r2.appendChild(div);
        }

        count = r2.querySelectorAll('.small_div');
        console.log(count.length);

        r2.setAttribute('data-connection', JSON.stringify([count.length]));
        // // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ í›„ ê°•ì œ í‰ê°€ ë¬¸ ì‹¤í–‰
        // window.forceWatchEvaluation();
    });

    parent.appendChild(div);
}